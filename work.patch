work

From: Anton Bobrov <a.bobrov@rambler-co.ru>


---
 .Xdefaults                            |   10 ++----
 .bash_profile                         |   10 +++++-
 .bashrc                               |   58 ++++++++++++++++++++++++++-------
 .config/openbox/rc.xml                |   18 +++-------
 .config/orcsome/rc.py                 |   31 +++---------------
 .gtkrc-2.0.mine                       |   17 +++++++++-
 .mplayer/config                       |   38 +---------------------
 .vimrc                                |   14 +++++++-
 .xinitrc                              |    8 ++---
 bin/box-session.sh                    |    4 ++
 bin/check-mail                        |    2 +
 bin/git-pull-all                      |   10 +++++-
 bin/rx                                |    2 +
 bin/xxx                               |    2 +
 etc/X11/xorg.conf.d/50-joystick.conf  |    6 +++
 etc/X11/xorg.conf.d/50-synaptics.conf |   53 ++++++++++++++++++++++++++----
 etc/X11/xorg.conf.d/50-vmmouse.conf   |    7 ++++
 etc/asound.conf                       |   17 +++-------
 18 files changed, 178 insertions(+), 129 deletions(-)
 create mode 100644 etc/X11/xorg.conf.d/50-joystick.conf
 create mode 100644 etc/X11/xorg.conf.d/50-vmmouse.conf

diff --git a/.Xdefaults b/.Xdefaults
index 944dca2..640f122 100755
--- a/.Xdefaults
+++ b/.Xdefaults
@@ -31,8 +31,7 @@ URxvt*color14: #84c2b3
 URxvt*color7: #dddddd
 URxvt*color15: #F8F8F2
 
-URxvt*font:	xft:Terminus:pixelsize=18,-xos4-terminus-medium-r-normal--16-140-72-72-c-80-koi8-u,xft:Monospace:antialias=false
-!URxvt*font:	xft:Lucida Console:pixelsize=17
+URxvt*font:	xft:Terminus:pixelsize=14,-xos4-terminus-medium-r-normal--14-140-72-72-c-80-koi8-u,xft:Monospace:antialias=false
 
 URxvt.keysym.Control-Insert:	perl:clipboard:copy
 URxvt.keysym.Shift-Down:	command:\033]721;6\007
@@ -40,7 +39,6 @@ URxvt.keysym.Shift-Insert:	perl:clipboard:paste
 URxvt.keysym.Shift-Up:	command:\033]720;6\007
 
 urxvt*lineSpace:	1
-!urxvt*skipBuiltinGlyphs: true
 
 URxvt.perl-ext-common:	default,matcher,clipboard
 URxvt.matcher.button:	3
@@ -50,7 +48,7 @@ URxvt*url-launcher:	firefox
 urxvt*meta8:	false
 URxvt*saveLines:	10000
 URxvt*scrollBar_right:	true
-URxvt*scrollBar:	false
+URxvt*scrollBar:	true
 URxvt*scrollstyle:	plain
 URxvt*shading:	20
 urxvt*termName:	xterm
@@ -69,7 +67,7 @@ Xft.hintstyle:  hintfull
 Xft.hinting: 1
 Xft.antialias: 1
 Xft.dpi: 96
-Xft.rgba: none 
+Xft.rgba: none
 
 xrenoise.display:	:0
 xrenoise.display_resource:	0x00,0x25,0x53,0x47,0x3A,0xBC,0xE9,0x67
@@ -79,5 +77,3 @@ xrenoise.use_xcursors:	1
 
 dzen2.foreground: #aaaaaa
 dzen2.background: #222222
-
-Emacs.FontBackend: xft
diff --git a/.bash_profile b/.bash_profile
index 1092a9c..d273957 100644
--- a/.bash_profile
+++ b/.bash_profile
@@ -1,2 +1,10 @@
 . $HOME/.bashrc
-[[ "$(fgconsole 2>/dev/null)" == "1" ]] && exec xxx
+
+_xfunc git __git_ps1 &>/dev/null
+
+eval $(ssh-agent)
+
+if [[ -z $DISPLAY && $(tty) = /dev/tty1 ]]; then
+    xxx
+    logout
+fi
diff --git a/.bashrc b/.bashrc
index 07ffd5d..ef2b105 100644
--- a/.bashrc
+++ b/.bashrc
@@ -10,8 +10,39 @@ alias ls='ls --color=auto'
 alias ll='ls -la'
 alias mc='mc -u'
 alias vimdiff=meld
+alias fpyg="fpy | xargs egrep"
+alias sc='sudo systemctl'
 
-PS1='\[\033[01;34m\]\w\[\033[31m\]$(__git_ps1 "[%s]")\[\033[01;32m\]$(__prompt_stgit)\[\033[01;34m\]$\[\033[00m\] '
+function __mercurial_qtop() {
+    qtop=`hg qtop 2>/dev/null`
+    [ -z "$qtop" ] || echo -n "($qtop)"
+}
+
+PS1='\[\033[01;34m\]\w\[\033[31m\]$(__git_ps1 "[%s]")\[\033[01;32m\]$(__prompt_stgit)$(__mercurial_qtop)\[\033[01;34m\]$\[\033[00m\] '
+
+__qrefresh_to() {
+    local prev cur
+    _get_comp_words_by_ref cur prev
+    COMPREPLY=( $( compgen -W "`hg qseries`" -- "$cur" ) )
+    return 0
+} &&
+complete -F __qrefresh_to qrefresh-to
+
+__fab_tasks() {
+    local prev cur
+    _get_comp_words_by_ref cur prev
+    COMPREPLY=( $( compgen -W "`fab -l -F short`" -- "$cur" ) )
+    return 0
+} &&
+complete -F __fab_tasks fab
+
+__svial() {
+    local prev cur
+    _get_comp_words_by_ref cur prev
+    COMPREPLY=( $( compgen -W "`find $HOME/.vim/sessions -mindepth 1 -type d | xargs --replace=^ basename ^`" -- "$cur"  ) )
+    return 0
+}
+complete -F __svial svial
 
 export PATH=$HOME/bin:$PATH
 export PROMPT_COMMAND=
@@ -22,22 +53,23 @@ shopt -s histappend
 
 export PAGER=most
 export EDITOR=vim
-
-export TERM=xterm-256color
-
-export PIP_DOWNLOAD_CACHE=~/.cache/pip
-export MPD_HOST=~/.mpd/socket
-
 export GIT_PS1_SHOWDIRTYSTATE=1
 export GIT_PS1_SHOWUNTRACKEDFILES=1
+export TERM=xterm-256color
 
-_xfunc git __git_ps1 &>/dev/null
-for fname in ~/.bash_sources/*; do
-    . $fname
-done
-
-export SDL_AUDIODRIVER=alsa
+export PIP_DOWNLOAD_CACHE=~/.cache/pip
 
+export LOGIBOX_SSH_KEY=/home/bobrov/.ssh/lb_rsa
 export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2
 
+#_xfunc git __git_ps1 &>/dev/null
+
 . /usr/bin/virtualenvwrapper.sh
+. /usr/share/snaked/completion/bash/snaked
+. /usr/share/git/git-prompt.sh
+
+export PERL_LOCAL_LIB_ROOT="$PERL_LOCAL_LIB_ROOT:/home/bobrov/perl5";
+export PERL_MB_OPT="--install_base /home/bobrov/perl5";
+export PERL_MM_OPT="INSTALL_BASE=/home/bobrov/perl5";
+export PERL5LIB="/home/bobrov/perl5/lib/perl5:$PERL5LIB";
+export PATH="/home/bobrov/perl5/bin:$PATH";
diff --git a/.config/openbox/rc.xml b/.config/openbox/rc.xml
index d22830a..c4674a8 100644
--- a/.config/openbox/rc.xml
+++ b/.config/openbox/rc.xml
@@ -218,7 +218,7 @@
 
   <keybind key="W-e">
     <action name="Execute">
-      <command>menu.sh</command>
+      <command>awesome-menu.sh</command>
     </action>
   </keybind>
 
@@ -537,23 +537,15 @@
     <focus>yes</focus>
   </application>
 
-  <application name="ranger">
-    <decor>true</decor>
-    <position>center</position>
-    <desktop>1</desktop>
-    <maximized>false</maximized>
-    <focus>yes</focus>
-  </application>
-
-  <application name="vial">
-    <decor>false</decor>
-    <desktop>1</desktop>
+  <application class="Opera" role="browser">
+    <decor>no</decor>
     <maximized>true</maximized>
     <focus>yes</focus>
   </application>
 
-  <application class="Opera" role="browser">
+  <application name="vial">
     <decor>no</decor>
+    <desktop>1</desktop>
     <maximized>true</maximized>
     <focus>yes</focus>
   </application>
diff --git a/.config/orcsome/rc.py b/.config/orcsome/rc.py
index dc0c92f..6c4a4c9 100644
--- a/.config/orcsome/rc.py
+++ b/.config/orcsome/rc.py
@@ -22,24 +22,6 @@ wm.on_key('Mod+bracketleft')(
 wm.on_key('Mod+bracketright')(
     spawn('mpc volume +2'))
 
-wm.on_key('Mod+period')(
-    spawn('mpc next'))
-
-wm.on_key('Mod+comma')(
-    spawn('mpc prev'))
-
-wm.on_key('Mod+slash')(
-    spawn('mpc-forward'))
-
-wm.on_key('Mod+grave')(
-    spawn('mpc-trash'))
-
-wm.on_key('Mod+apostrophe')(
-    spawn('mpc-add-tag blade'))
-
-wm.on_key('Mod+semicolon')(
-    spawn('mpc-add-tag listen'))
-
 wm.on_key('Mod+p')(
     spawn('mpc toggle'))
 
@@ -49,17 +31,14 @@ wm.on_key('XF86_MonBrightnessUp')(
 wm.on_key('XF86_MonBrightnessDown')(
     spawn('sudo backlight down'))
 
-wm.on_key('XF86_PowerOff')(
-    spawn('sudo pm-suspend'))
-
 wm.on_key('Mod+i')(
     spawn_or_raise('urxvtc -name weechat -e weechat-curses', name='weechat'))
 
-#wm.on_key('Mod+l')(
-#    spawn_or_raise('fmd', cls='Fmd'))
-
 wm.on_key('Mod+l')(
-    spawn_or_raise('urxvtc -g 100x30 -name ranger -e ranger', name='ranger'))
+    spawn_or_raise('fmd', cls='Fmd'))
+
+wm.on_key('Mod+q')(
+    spawn('xlock -mode blank'))
 
 ################################
 # Handle quick apps window close
@@ -73,7 +52,7 @@ wm.on_key('Ctrl+Alt+p')(
     spawn_or_raise('urxvtc -name ncmpcpp -e ncmpcpp', name='ncmpcpp', **restore_focus))
 
 wm.on_key('Mod+n')(
-    spawn_or_raise('urxvtc -name mutt -e sh -c "sleep 1; mutt"', name='mutt', **restore_focus))
+    spawn_or_raise('urxvtc -name mutt -e mutt', name='mutt', **restore_focus))
 
 wm.on_key('Ctrl+Alt+m')(
     spawn_or_raise('urxvtc -name alsamixer -e alsamixer', name='alsamixer', **restore_focus))
diff --git a/.gtkrc-2.0.mine b/.gtkrc-2.0.mine
index 18ab184..762793c 100644
--- a/.gtkrc-2.0.mine
+++ b/.gtkrc-2.0.mine
@@ -6,7 +6,7 @@ gtk-icon-theme-name = "elementary-mono-dark"
 
 #gtk-theme-name = "Candido-Mist"
 gtk-toolbar-style   = GTK_TOOLBAR_ICONS
-gtk-font-name = "Droid Sans 12"
+gtk-font-name = "Arial 10"
 
 style "thin-scrollbar"
 {
@@ -16,6 +16,14 @@ style "thin-scrollbar"
   GtkScrollbar   ::has-backward-stepper = 0  
 }
 
+style "thick-scrollbar"
+{
+  GtkRange       ::slider_width      = 24
+  GtkRange       ::stepper_size      = 24
+  GtkScrollbar   ::has-forward-stepper = 1
+  GtkScrollbar   ::has-backward-stepper = 1  
+}
+
 class "GtkRange" style "thin-scrollbar"
 
 
@@ -24,8 +32,15 @@ style "scrolled-window-without-space"
   GtkScrolledWindow ::scrollbar-spacing = 0
 }
 
+style "snaked-dark-background" {
+  bg[NORMAL] = "#242424"
+}
+
+widget "SnakedWindow.*.GtkSourceView" style "snaked-dark-background"
 widget "SnakedWindow.*.GtkScrolledWindow" style "scrolled-window-without-space"
 
+widget "OOoFixed.*.GtkRange" style "thick-scrollbar"
+
 
 style "condensed-tree-view"
 {
diff --git a/.mplayer/config b/.mplayer/config
index 8f5eed6..21cf775 100644
--- a/.mplayer/config
+++ b/.mplayer/config
@@ -1,39 +1,3 @@
-[default]
-use-filedir-conf=yes
-ao=alsa
-alang=jpn
+# Write your default config options here!
 
-#cache=16384
-#cache-min=50
-nocache=yes
-framedrop=no
 
-softvol=yes
-softvol-max=300
-volstep=1
-#af=pan=6:.32:.39:.06:.17:-.17:.33:.32:.06:.39:-.17:.17:.33
-#srate=44100
-
-#fontconfig=yes
-ass=yes
-#ass-font-scale = 1
-subcp=enca:ru:utf8
-#slang=rus
-osd-duration=3000
-#subfont-autoscale = 0
-#subfont-text-scale = 5
-#subfont-osd-scale = 30
-
-#vo=gl:backend=1:yuv=2
-vo=gl:yuv=2
-dr=yes
-noslices=yes
-#vo=xv
-#vfm=ffmpeg
-#lavdopts=fast=yes:skiploopfilter=all
-#lavdopts=threads=2:fast=yes:skiploopfilter=all
-
-fs=yes
-
-[gnome-mplayer]
-msglevel=all=5
diff --git a/.vimrc b/.vimrc
index 1bc675d..33b0acf 100644
--- a/.vimrc
+++ b/.vimrc
@@ -4,6 +4,7 @@ execute pathogen#infect()
 
 syntax on
 filetype indent plugin on
+
 set nocompatible
 set background=dark
 
@@ -44,6 +45,10 @@ set formatoptions=qrn1
 
 set sessionoptions=buffers,curdir
 
+set langmap=ФИСВУАПРШОЛДЬТЩЗЙКЫЕГМЦЧНЯ;ABCDEFGHIJKLMNOPQRSTUVWXYZ,фисвуапршолдьтщзйкыегмцчня;abcdefghijklmnopqrstuvwxyz
+set spelllang=en_us,ru_ru
+set spellcapcheck=
+
 
 " Common mappings
 let mapleader = ','
@@ -63,8 +68,8 @@ imap <c-j> jklysL
 inoremap <c-l> <c-o>a
 
 inoremap jk <esc>
+inoremap ОЛ <esc>
 inoremap <esc> <nop>
-
 inoremap OA <nop>
 inoremap OB <nop>
 inoremap OC <nop>
@@ -96,10 +101,15 @@ augroup END
 nnoremap <leader>m :VialQuickOpen<cr>
 
 
+" UltiSnips
+let g:UltiSnipsJumpForwardTrigger="<tab>"
+let g:UltiSnipsJumpBackwardTrigger="<s-tab>"
+
+
 " Restore cursor
 function! ResCur()
   if line("'\"") <= line("$")
-    normal! g`"
+    normal! g`"zz
     return 1
   endif
 endfunction
diff --git a/.xinitrc b/.xinitrc
index cc2200c..b0b85c4 100644
--- a/.xinitrc
+++ b/.xinitrc
@@ -1,17 +1,15 @@
 #/bin/sh
 
-xrdb -merge ~/.Xdefaults
 xset r rate 200 40
+xset m 1/8 2
 urxvtd -q -f -o
 
-xinput set-button-map "ETPS/2 Elantech Touchpad" 2 1 3
+xinput set-button-map `xinput list --short "SynPS/2 Synaptics TouchPad" | awk '{ match($0, /.*=([0-9]+)/, arr); print arr[1]}'` 2 1 3
 
 xgamma -bgamma 0.74 -ggamma 0.95 -rgamma 1.05 &
 
 kbdd
-xbacklight -set 80
-devmon &> /tmp/devmon.log &
 
-exec dbus-launch --exit-with-session ~/bin/box-session.sh
+exec dbus-launch ~/bin/box-session.sh
 #exec ck-launch-session /usr/bin/fvwm2
 #exec ck-launch-session /usr/bin/fluxbox -log /tmp/fb.log -verbose
diff --git a/bin/box-session.sh b/bin/box-session.sh
index 7135259..2852a1c 100755
--- a/bin/box-session.sh
+++ b/bin/box-session.sh
@@ -1,10 +1,12 @@
 #!/bin/sh
 
+xrdb -merge ~/.Xdefaults
+
+devmon &
 notipy &
 bmpanel2 &
 gatotray &
 orcsome -l /tmp/orcsome.log &
 feh --bg-center wallpapers/story.png
-#xcompmgr -cC -t-5 -l-5 -r4.2 -o.55 &
 
 exec openbox
diff --git a/bin/check-mail b/bin/check-mail
index e56cd27..b052d17 100755
--- a/bin/check-mail
+++ b/bin/check-mail
@@ -14,5 +14,5 @@ for match in re.finditer(r'(?m)^(\d+) messages \((\d+) seen\) for (.+) at ', std
     if new_messages:
         email = match.group(3)
         n = pynotify.Notification('New mail', '{} ({})'.format(email, new_messages))
-        n.set_timeout(5000)
+        n.set_timeout(10000)
         n.show()
diff --git a/bin/git-pull-all b/bin/git-pull-all
index 5113d41..c418183 100755
--- a/bin/git-pull-all
+++ b/bin/git-pull-all
@@ -1,5 +1,13 @@
 #!/bin/sh
 
 current=`git status -sb | head -1 | cut -d ' ' -f 2`
-git remote show origin -n | grep 'merges with' | awk '{print $1}' | xargs --replace=^ echo "git checkout ^ && git pull --ff-only" | sh
+
+for branch in $(git remote show origin -n | grep 'merges with' | awk '{print $1}'); do
+    git checkout $branch
+    top=$(stg top 2>/dev/null)
+    stg pop -a
+    git pull --ff-only
+    stg goto $top
+done
+
 git co $current
diff --git a/bin/rx b/bin/rx
index eb04fe2..8de44c4 100755
--- a/bin/rx
+++ b/bin/rx
@@ -1,4 +1,4 @@
 #!/bin/sh
 CMD=`which "$1"` || exit 1
 shift
-xinit "$CMD" "$@" -- :1 
+xinit $CMD "$@" -- :1 
diff --git a/bin/xxx b/bin/xxx
index d0e635c..4fed9f9 100755
--- a/bin/xxx
+++ b/bin/xxx
@@ -1,3 +1,3 @@
 #/bin/sh
 
-exec startx |& trout 1000000 /tmp/xsession.log
+exec xinit -- -nolisten tcp |& trout 1000000 /tmp/xsession.log
diff --git a/etc/X11/xorg.conf.d/50-joystick.conf b/etc/X11/xorg.conf.d/50-joystick.conf
new file mode 100644
index 0000000..95a295a
--- /dev/null
+++ b/etc/X11/xorg.conf.d/50-joystick.conf
@@ -0,0 +1,6 @@
+Section "InputClass"
+	Identifier "joystick catchall"
+	MatchIsJoystick "on"
+	MatchDevicePath "/dev/input/event*"
+	Driver "joystick"
+EndSection
diff --git a/etc/X11/xorg.conf.d/50-synaptics.conf b/etc/X11/xorg.conf.d/50-synaptics.conf
index 073c722..97cd95e 100644
--- a/etc/X11/xorg.conf.d/50-synaptics.conf
+++ b/etc/X11/xorg.conf.d/50-synaptics.conf
@@ -1,13 +1,50 @@
+# Example xorg.conf.d snippet that assigns the touchpad driver
+# to all touchpads. See xorg.conf.d(5) for more information on
+# InputClass.
+# DO NOT EDIT THIS FILE, your distribution will likely overwrite
+# it when updating. Copy (and rename) this file into
+# /etc/X11/xorg.conf.d first.
+# Additional options may be added in the form of
+#   Option "OptionName" "value"
+#
 Section "InputClass"
         Identifier "touchpad catchall"
         Driver "synaptics"
         MatchIsTouchpad "on"
-	Option "TapButton1" "2"
-	Option "VertEdgeScroll" "false"
-	Option "HorizEdgeScroll" "false"
-	Option "SHMConfig" "on"
-	Option "VertTwoFingerScroll" "true"
-	Option "LockedDrags" "true"
-	Option "LockedDragTimeout" "1500"
-	Option "VertScrollDelta" "60"
+        Option "TapButton1" "1"
+        Option "TapButton2" "2"
+        Option "TapButton3" "3"
+# This option is recommend on all Linux systems using evdev, but cannot be
+# enabled by default. See the following link for details:
+# http://who-t.blogspot.com/2010/11/how-to-ignore-configuration-errors.html
+        MatchDevicePath "/dev/input/event*"
+EndSection
+
+Section "InputClass"
+        Identifier "touchpad ignore duplicates"
+        MatchIsTouchpad "on"
+        MatchOS "Linux"
+        MatchDevicePath "/dev/input/mouse*"
+        Option "Ignore" "on"
+EndSection
+
+# This option enables the bottom right corner to be a right button on
+# non-synaptics clickpads.
+# This option is only interpreted by clickpads.
+Section "InputClass"
+        Identifier "Default clickpad buttons"
+        MatchDriver "synaptics"
+        Option "SoftButtonAreas" "50% 0 82% 0 0 0 0 0"
+#       To disable the bottom edge area so the buttons only work as buttons,
+#       not for movement, set the AreaBottomEdge
+#       Option "AreaBottomEdge" "82%"
+EndSection
+
+# This option disables software buttons on Apple touchpads.
+# This option is only interpreted by clickpads.
+Section "InputClass"
+        Identifier "Disable clickpad buttons on Apple touchpads"
+        MatchProduct "Apple|bcm5974"
+        MatchDriver "synaptics"
+        Option "SoftButtonAreas" "0 0 0 0 0 0 0 0"
 EndSection
diff --git a/etc/X11/xorg.conf.d/50-vmmouse.conf b/etc/X11/xorg.conf.d/50-vmmouse.conf
new file mode 100644
index 0000000..35c438e
--- /dev/null
+++ b/etc/X11/xorg.conf.d/50-vmmouse.conf
@@ -0,0 +1,7 @@
+Section "InputClass"
+	Identifier	"vmmouse"
+	MatchIsPointer	"on"
+	MatchTag	"vmmouse"
+	Driver		"vmmouse"
+EndSection
+
diff --git a/etc/asound.conf b/etc/asound.conf
index 383b22c..34e9b0c 100644
--- a/etc/asound.conf
+++ b/etc/asound.conf
@@ -3,21 +3,13 @@ pcm.!default {
   slave.pcm "dmixer"
 }
 
-pcm.dmixout {
-  # Just pass this on to the system dmix
-  type plug
-  slave {
-     pcm "current"
-  }
-}
-
 pcm.dmixer {
     type dmix
     ipc_key 1024
     ipc_key_add_uid false   # let multiple users share
     ipc_perm 0666
     slave {
-      pcm "current"
+      pcm "hw:0,0"
       channels 2
       period_time 0
       period_size 1024 # must be power of 2
@@ -29,16 +21,19 @@ pcm.dmixer {
 }
 
 pcm.dsp0 {
-   slave.pcm "hw:1,0"
+   type asym
+   playback.pcm "dmixer"
+   capture.pcm "dsnooped"
 }
 
 pcm.dsnooped {
    ipc_key 1027
    type dsnoop
-   slave.pcm Track
+   slave.pcm "hw:0,0"
    slave.rate 44100
    slave.channels 2
    slave.buffer_size 512
    bindings.0  0
    bindings.1  0
 }
+   
